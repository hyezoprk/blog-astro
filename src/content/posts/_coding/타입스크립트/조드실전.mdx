---
title: zodì™€ ë°ì´í„°
date: '2023-02-10'
categories: coding
tags: íƒ€ì…ìŠ¤í¬ë¦½íŠ¸
description: zod
---
<HeadingNavigator />

ì½”ë”©í•  ë•Œ ë©”ì´ì € ê¸°ìˆ ì´ ì•„ì‰½ê²Œ ëŠê»´ì§ˆ ë•Œë„ ìˆë‹¤.  
ë¹„ë£¨í•œ ë‚´ê°€ ê¸°ì–µí•˜ëŠ” ì²«ì§¸ëŠ” `GraphQL` ì—ì„œë‹¤. ì„œë²„ ìª½ì—ì„œ ì‹¤ì»· ê³µë“¤ì—¬ ìŠ¤í‚¤ë§ˆë¥¼ ì§°ëŠ”ë°, ì´ë¥¼ í´ë¼ì´ì–¸íŠ¸ì— í†µìš©ì‹œí‚¤ì§€ ëª»í•˜ê³  ìƒˆë¡œ íƒ€ì… ì •ì˜ë¥¼ í•´ì•¼ í•  ë•Œ ì§„ì§œ ì§œì¦ë‚¬ë‹¤ã…ã… ì‘ì—…ëŸ‰ì´ ë‘ ë°°.. ê·¸ ë°˜í–¥ìœ¼ë¡œ ì´ê²ƒì €ê²ƒ ì°¾ì•˜ê³ , `trpc`ë¥¼ ì ‘í•œ ê²ƒë„ ê·¸ë•Œì˜€ë‹¤.  
ê·¸ë ‡ê²Œ ë³´ë©´ ë‘ë²ˆì§¸ë„ ê°™ì€ ë§¥ë½ì´ë‹¤. íƒ€ì…ìŠ¤í¬ë¦½íŠ¸ì˜ ì†Œê·¹ì„±ì´ë¼ê³  ë¶ˆëŸ¬ë„ ë ê¹Œ? ê·¸ëŸ¬ë‹ˆê¹Œ íƒ€ì…ìŠ¤í¬ë¦½íŠ¸ê°€ íƒ±ì»¤ ì—­í• ë§Œ í•  ê²Œ ì•„ë‹ˆë¼, íŒŒì‹±, ë‚˜ì•„ê°€ ê°€ê³µê¹Œì§€ ë”œ ì¢€ ë„£ì„ ìˆ˜ ìˆìœ¼ë©´ ì¢‹ê² ë‹¨ ìƒê°ì„ í–ˆë‹¤. ê±°ê¸°ì— ë‚´ê°€ ê¸°ì—¬í•œ ë°”ëŠ” ì—†ì§€ë§Œ ë§ì´ë‹¤.  
`zod`ì˜ ì¡´ì¬ëŠ” ê·¸ëŸ° ë¶ˆë§Œë“¤ê³¼ ë§ë‹¿ì•„ ìˆëŠ” ê²ƒ ê°™ë‹¤.

---

### zod
íƒ€ì…ìŠ¤í¬ë¦½íŠ¸ì˜ ìŠ¤í‚¤ë§ˆ íŒŒì”½, ê·¸ë¦¬ê³  ê²€ì¦ì„ ë„ì™€ì£¼ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ë‹¤. 
> "Zod allows you to work around uncertainty by checking types at the <q>runtime</q> level as well at the type level. The goal is to eliminate duplicative type declarations. With Zod, you declare a validator once and Zod will automatically infer the static TypeScript type. It's easy to compose simpler types into complex data structures."
<cite>Matt Pocock</cite>

### ë¬¸ë²•
<CH.Scrollycoding>
- ê¸°ì´ˆ  
ê¸°ë³¸ì ìœ¼ë¡œ `required` ì ìš©ì´ë‹¤. í•¨ìˆ˜í˜• íŒŒì´í”„ë¼ì¸ì„ ì´ì–´ì„œ ë°ì´í„°ë¥¼ `íŒŒì‹±`í•œë‹¤.  
ì˜ˆì‹œë§Œ ë´ë„ íƒ€ì…ìŠ¤í¬ë¦½íŠ¸ì˜ í˜•íƒœê°€ ì–¼ì¶” ì½íˆê¸° ë•Œë¬¸ì— ê¸ˆë°© ëˆˆì— ìµí ìˆ˜ ìˆì„ ê²ƒ ê°™ë‹¤.
```ts index1.ts
import { z } from "zod"

const UserSchema = z.object({
  username: z.string().min(2).max(10),
  age: z.number().gt(0).optional(),
  email: z.stirng().email(),
  birthday: z.date(),nullish(),
  isStudent: z.boolean().default(true),
  func: z.void().or(z.any()),
})

type User = z.infer<typeof UserSchema>

const user: User = { username: 1 }

console.log(UserSchema.parse(user));
```
---
- ì‹¬í™”  
ëŒ€ì¶© ìì£¼ ì“¸ ê²ƒ ê°™ì€ ì• ë“¤ë§Œ ì¶”ë ¸ë‹¤.    
<Lnk text='zod ê³µí™ˆ' href='https://zod.dev/' /> íƒ­ í•˜ë‚˜ì— ê±¸ì–´ ë†“ê³  ì‹¬ì‹¬í•  ë•Œ ì½ì–´ë³´ê³  ìˆë‹¤.  
```ts index2.ts
.gt(): ~ì´ìƒ
.lt(): ~ì´í•˜
.default(): ê¸°ë³¸ê°’
.optional(): ì„ íƒê°’
.nullish(): `null`ê³¼ ê°™ì€ ê°’ë“¤ì´ ì˜¬ ìˆ˜ ìˆëŠ”ì§€
.nullable(): `null`ì´ ì˜¬ ìˆ˜ ìˆëŠ”ì§€
z.url(): url í˜•ì‹(`https://`) ê²€ì¦
z.email(): ì´ë©”ì¼ í˜•ì‹(`@`) ê²€ì¦

z.enum([]): íƒ€ì…ìŠ¤í¬ë¦½íŠ¸ ì´ë„˜ì´ ì•„ë‹ˆë¼ ìœ ë‹ˆì–¸ì²˜ëŸ¼ íŒŒì‹±ë¨
z.union([])
// mark
z.discriminatedUnion()
z.or()
z.and()

z.object.partial(): ì˜¤ë¸Œì íŠ¸ì˜ ëª¨ë“  ê°’ë“¤ì„ ì˜µì…”ë„ë¡œ ì „í™˜. íƒ€ì…ìŠ¤í¬ë¦½íŠ¸ì˜ `Partial`ê³¼ ê°™ìŒ.
z.object.deepPartial(): nestí•œ ì˜ì—­ê¹Œì§€ ëª¨ë‘ ì˜µì…”ë„ë¡œ ì „í™˜.
z.object.pick(): íƒ€ì…ìŠ¤í¬ë¦½íŠ¸ì˜ `pick`
z.object.omit(): íƒ€ì…ìŠ¤í¬ë¦½íŠ¸ì˜ `omit`
z.object.extend(): íƒ€ì…ìŠ¤í¬ë¦½íŠ¸ì˜ `extend`
z.object.merge(): íƒ€ì…ìŠ¤í¬ë¦½íŠ¸ì˜ `intersection`  

z.array(z.string()).nonempty()
z.tuple([z.number(), z.string(), z.number()].rest(z.number()))


z.record()
z.map()
z.set()
z.promise()

// mark
z.input()
// mark
z.infer()
// mark
.refine(): ì„¸ë¶€ ê²€ì¦ì‹ ì‘ì„±. `value => value.METHOD`
// mark
.transform(): ë“¤ì—¬ì˜¨ ë°ì´í„°ë¥¼ ë‚´ êµ¬ë¯¸ì— ë§ê²Œ ë³€í˜•/ê°€ê³µì‹œí‚¬ ë•Œ ì‚¬ìš©. `value => `
```
</CH.Scrollycoding>

<br/>
### ì‹¤ì „ì˜ˆì œ
<CH.Spotlight>
```ts vitest.test.ts
import { expect, it } from "vitest";
import { z } from "zod";

const StarWarsPerson = z.object({
  name: z.string(),
});

const StarWarsPeopleResults = z.object({
  results: z.array(StarWarsPerson),
});

export const fetchStarWarsPeople = async () => {
  const data = await fetch(
    "https://www.totaltypescript.com/swapi/people.json",
  ).then((res) => res.json());

  const parsedData = StarWarsPeopleResults.parse(data);

  return parsedData.results;
};

// TEST ğŸ¦–

it("Should resolve the name and nameAsArray", async () => {
  expect((await fetchStarWarsPeople())[0]).toEqual({
    name: "Luke Skywalker",
    nameAsArray: ["Luke", "Skywalker"],
  });
});
```
---
- ìŠ¤íƒ€ì›Œì¦ˆ ë°ì´í„°ë¥¼ `fetch` í•˜ë ¤ í•œë‹¤.  
ìƒˆíƒ­ì—ì„œ êµ¬ì¡°ë¥¼ í™•ì¸í•´ë³´ì
<CH.Code>
```ts vitest.test.ts focus=12:15
```
```json data.json
{
  "count": 82,
  "next": "https://swapi.dev/api/people/?page=2",
  "previous": null,
  "results": [
    {
      "name": "Luke Skywalker",
      "height": "172",
      "mass": "77",
      "hair_color": "blond",
      "skin_color": "fair",
      "eye_color": "blue",
      "birth_year": "19BBY",
      "gender": "male",
      "homeworld": "https://swapi.dev/api/planets/1/",
      "films": [
        "https://swapi.dev/api/films/1/",
        "https://swapi.dev/api/films/2/",
        "https://swapi.dev/api/films/3/",
        "https://swapi.dev/api/films/6/"
      ],
      "species": [],
      "vehicles": [
        "https://swapi.dev/api/vehicles/14/",
        "https://swapi.dev/api/vehicles/30/"
      ],
      "starships": [
        "https://swapi.dev/api/starships/12/",
        "https://swapi.dev/api/starships/22/"
      ],
      "created": "2014-12-09T13:50:51.644000Z",
      "edited": "2014-12-20T21:17:56.891000Z",
      "url": "https://swapi.dev/api/people/1/"
    },
    {
      "name": "C-3PO",
      "height": "167",
      "mass": "75",
      "hair_color": "n/a",
      "skin_color": "gold",
      "eye_color": "yellow",
      "birth_year": "112BBY",
      "gender": "n/a",
      "homeworld": "https://swapi.dev/api/planets/1/",
      "films": [
        "https://swapi.dev/api/films/1/",
        "https://swapi.dev/api/films/2/",
        "https://swapi.dev/api/films/3/",
        "https://swapi.dev/api/films/4/",
        "https://swapi.dev/api/films/5/",
        "https://swapi.dev/api/films/6/"
      ],
      "species": [
        "https://swapi.dev/api/species/2/"
      ],
      "vehicles": [],
      "starships": [],
      "created": "2014-12-10T15:10:51.357000Z",
      "edited": "2014-12-20T21:17:50.309000Z",
      "url": "https://swapi.dev/api/people/2/"
    },
    {
      "name": "R2-D2",
      "height": "96",
      "mass": "32",
      "hair_color": "n/a",
      "skin_color": "white, blue",
      "eye_color": "red",
      "birth_year": "33BBY",
      "gender": "n/a",
      "homeworld": "https://swapi.dev/api/planets/8/",
      "films": [
        "https://swapi.dev/api/films/1/",
        "https://swapi.dev/api/films/2/",
        "https://swapi.dev/api/films/3/",
        "https://swapi.dev/api/films/4/",
        "https://swapi.dev/api/films/5/",
        "https://swapi.dev/api/films/6/"
      ],
      "species": [
       "https://swapi.dev/api/species/2/"
      ],
      "vehicles": [],
      "starships": [],
      "created": "2014-12-10T15:11:50.376000Z",
      "edited": "2014-12-20T21:17:50.311000Z",
      "url": "https://swapi.dev/api/people/3/"
    },
    ...ê³„ì†
  ]
}    
```
</CH.Code>
---
- `results`ì— í•´ë‹¹í•˜ëŠ” ë¶€ë¶„ë§Œ í•„ìš”í•˜ë¯€ë¡œ ë‹¤ìŒì²˜ëŸ¼ íŒŒì‹±ì„ ì¤€ë¹„í•œë‹¤.  
ì´ëŠ” ê·¸íì—˜ì—ì„œ í•„ìš”í•œ ì¿¼ë¦¬ë§Œ ìš”ì²­í•˜ëŠ” ê²ƒê³¼ ê°™ë‹¤. ê·¸ ë§ì€ ì˜ˆë¹„ì„¤ê³„ ì—†ì´ë„.!
```ts vitest.test.ts focus=8:10,17
```
---
- `results`ì—ëŠ” ì—¬ëŸ¬ ì¸ë¬¼ë“¤ì˜ ì •ë³´ê°€ ë°°ì—´ë¡œ ë‹´ê²¨ ìˆê³ , ê° ì¸ë¬¼ë“¤ì˜ ì •ë³´ëŠ” ë˜‘ê°™ì€ ì˜¤ë¸Œì íŠ¸ í•­ëª©ìœ¼ë¡œ êµ¬ì„±ë¼ ìˆë‹¤.  
ì—¬ê¸°ì„œëŠ” ìµœëŒ€í•œ ê°„ë‹¨í•˜ê²Œ `name`ë§Œì„ ì¶”ì¶œí•´ë´¤ë‹¤. ê·¸ëŸ¬ë©´ ê° ì¸ë¬¼ë“¤ì˜ ì´ë¦„ë§Œ ì†ì†ë“¤ì´ `fetch` ë  í…ë°,
```ts vitest.test.ts focus=4:6,9[19:34]
```
---
- ê·¼ë° `zod`ëŠ” ì—¬ê¸°ì„œ ë©ˆì¶”ì§€ ì•ŠëŠ”ë‹¤. ë°ì´í„°ë¥¼ ìˆ˜ë™ì ìœ¼ë¡œ `fetch` í•˜ëŠ” ê±¸ ë„ˆë¨¸, ì› ë°ì´í„°ì— ì—†ëŠ” ìƒˆë¡œìš´ ê°’ì„ ê°€ê³µí•˜ì—¬ ë¼ì›Œë„£ì„ ìˆ˜ ìˆë‹¤.  
ê°€ë ¹ `nameAsArray`ë¼ëŠ” í•­ëª©ìœ¼ë¡œ ì„±ê³¼ ì´ë¦„ì„ ë¶„ë¦¬ì‹œì¼œ ë°›ì•„ë³´ì.
```ts vitest.test.ts focus=22:29
```
---
- `.transform( )` íŒŒì´í”„ê°€ ê·¸ëŸ° ê¸°ëŠ¥ì„ ë‹´ë‹¹í•œë‹¤.  
í•¨ìˆ˜ë¥¼ ë°›ëŠ”ë°, ì—°ê²°í•œ ë°ì´í„°ì˜ ë‚´ìš©ì´ ì²«ë²ˆì§¸ íŒŒë¼ë¯¸í„° ì•ˆì— ë‹´ê²¨ì˜¨ë‹¤. `spread operator`ë¡œ ì´ë¥¼ ë³µì‚¬í•˜ê³  ë§Œë“¤ë ¤ëŠ” ë°ì´í„°ë¥¼ ì•„ë˜ ì¶”ê°€í•˜ì—¬ ë¦¬í„´í–ˆë‹¤.  

```ts vitest.test.ts focus=4:9 mark=6[3:22],7[3:9],8[3:34],9[1:3]
import { expect, it } from "vitest";
import { z } from "zod";

const StarWarsPerson = z.object({
  name: z.string()
}).transform(Obj => ({
  ...Obj,
  nameAsArray: Obj.name.split(" ")
}))

const StarWarsPeopleResults = z.object({
  results: z.array(StarWarsPerson),
});

export const fetchStarWarsPeople = async () => {
  const data = await fetch(
    "https://www.totaltypescript.com/swapi/people.json",
  ).then((res) => res.json());

  const parsedData = StarWarsPeopleResults.parse(data);

  return parsedData.results;
};

// TEST ğŸ¦–

it("Should resolve the name and nameAsArray", async () => {
  expect((await fetchStarWarsPeople())[0]).toEqual({
    name: "Luke Skywalker",
    nameAsArray: ["Luke", "Skywalker"],
  });
});
```
</CH.Spotlight>

### ê²°ê³¼

í…ŒìŠ¤íŠ¸ ë¬´ì‚¬í†µê³¼!!
<Img src='/images/2023/typescript/ZodResult.webp' />