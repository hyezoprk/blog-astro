---
title: "posts í´ë”ë¥¼ ê³„ì¸µí™”í•˜ê¸°"
date: "2022-09-20"
categories: "project"
tags: "ë¸”ë¡œê·¸ í¬íŠ¸í´ë¦¬ì˜¤"
description: "refactor"
---
<HeadingNavigator />
í¬ìŠ¤íŒ…ì´ ëŠ˜ì–´ë‚˜ë©´ì„œ íŒŒì¼ ê´€ë¦¬ê°€ ì ì  í˜ë“¤ì–´ì§€ê²Œ ëë‹¤.  
Next ê³µì‹ íŠœí† ë¦¬ì–¼ì„ ë”°ë¼ê°ˆ ë•Œ, í•˜ë‚˜ì˜ í´ë”ë¥¼ ëŒ€ìƒìœ¼ë¡œë§Œ `posts`ë¥¼ ì½íˆê²Œ ë§Œë“¤ì–´ë†“ì€ íƒ“ì´ë‹¤. ì§€ê¸ˆì€ ì´ í´ë” ì•ˆì— .mdx ì™¸ì˜ íŒŒì¼ì´ ë“¤ì–´ê°€ë©´ ì—ëŸ¬ê°€ ë‚œë‹¤. ìš©ë‚©ë ê¹Œ? ì•ˆëœë‹¤ ğŸ«¥  
<br/>
ê·¸ë˜ì„œ ì˜¤ëŠ˜ì˜ ì£¼ì œëŠ” ê³„ì¸µí™”(= ì„¸ë¶„í™”, í•˜ìœ„í´ë”í™”)ë‹¤.

<hr/>

### ë¬¸ì œ ì§„ë‹¨

ë¨¼ì € ì§€ê¸ˆ í¬ìŠ¤íŠ¸ëŠ” ì´ë ‡ê²Œ ì½íˆê³  ìˆë‹¤.

```ts src/lib/posts.ts
// post ë³´ê´€í•¨ì„ rootì˜ draftsë¡œ ì§€ì •
const postsDirectory = path.join(process.cwd(), "drafts");

export function getSortedPostsData(tags?: string) {
  // ë³´ê´€í•¨ì— ìˆëŠ” íŒŒì¼ ì´ë¦„ë“¤ ì¶”ì¶œ
  const fileNames = fs.readdirSync(postsDirectory);
  // ê·¸ê²ƒë“¤ì„ ë§µìœ¼ë¡œ ëŒë¦´ ê±´ë°
  const allPostsData = fileNames.map(fileName => {
    // íŒŒì¼ ì´ë¦„ì—ì„œ ".mdx" í™•ì¥ìëª…ëŠ” ì œê±°í•˜ê³ 
    const id = fileName.replace(/\.mdx$/, "");
    // íŒŒì¼ë§ˆë‹¤ ì†ë‚´ìš©ì„ ì½ì–´ë“¤ì¼ ê±°ì•¼
    const fullPath = path.join(postsDirectory, fileName);
    const fileContents = fs.readFileSync(fullPath, "utf8");
    // ê·¸ì¤‘ì—ì„œë„ ë©”íƒ€ë°ì´í„° ì„¹ì…˜ì„ gray-matter í•¨ìˆ˜ë¥¼ í†µí•´ ì½ì–´ë³¼ê²Œ
    const matterResult = matter(fileContents).data;
    // ìµœì¢…ë°˜í™˜ ë°ì´í„°: í¬ìŠ¤íŠ¸ì˜ id, titleì„ ë¹„ë¡¯í•œ ë©”íƒ€ë°ì´í„°ë“¤
    return {
      id,
      tags: matterResult.tags as string,
      date: matterResult.date as string,
      ...matterResult,
    };
  });
```
<Img src={'/images/2022/autumm/before.png'} />

<br/>
ì´ ëª¨ìŠµëŒ€ë¡œë¼ë©´ `readdirSync()`ê°€ ìµœìƒìœ„ì— ì„ ì–¸ëœ `drafts` í´ë”ë§Œì„ ì½ì„ ìˆ˜ ìˆë‹¤. ì§ì„ ì , ê³ ì •ì ì¸ ì›€ì§ì„ìœ¼ë¡œ í•˜ë‚˜ì˜ í´ë”ë§Œ ëŒ€ìƒì´ ëœë‹¤.  
<br/>
ê²½ë¡œë¥¼ ì½ëŠ” ë¶€ë¶„ì„ ìˆœí™˜ì‹œì¼œì•¼í•¨ì´ ë§ˆë•…í•´ ë³´ì˜€ë‹¤. ê·¼ë° ë§‰ìƒ í•´ë³´ë ¤ë‹ˆ ì˜ ì•ˆ ëë‹¤ëŠ” ìˆ¨ê¸°ê³  ì‹¶ì€ ë¹„í•˜ì¸ë“œê°€ ìˆê³ ..ã…ã… recursiveí•œ êµ¬ì¡°ì— ì•„ì§ ì–´ë²„ë²„í•œ ê²ƒ ê°™ë‹¤ğŸ˜¥ ë‹¤í–‰íˆ êµ¬ê¸€ë§ìœ¼ë¡œ ì‹¤ë§ˆë¦¬ë¥¼ ì°¾ì„ ìˆ˜ ìˆì—ˆë‹¤.  

<br/>
### í•¨ìˆ˜ ìª¼ê°œê¸°
ì‹¤ë§ˆë¦¬ë¼ê³  í–ˆì§€ë§Œ ì‚¬ì‹¤ ë‹¤ ì°¨ë ¤ì§„ ë°¥ìƒì´ì—ˆë‹¤.  
ì°¸ê³ í•œ ë§í¬[^1]ë¥¼ ë³´ë©´ ê²½ë¡œë¥¼ ë§¤ê°œë³€ìˆ˜ë¡œ ë°›ì•„ ëª¨ë“  í´ë”ë¥¼ íƒìƒ‰í•œë‹¤. ë‚´ë¶€ì˜ ë¡œì§ì€  
   1. íŒŒì¼ì¼ ê²½ìš° ë¦¬í„´  
   2. í´ë”ì¼ ê²½ìš° ìƒˆë¡œìš´ ê²½ë¡œê°’ìœ¼ë¡œ ë‹¤ì‹œ í•œë²ˆ í•¨ìˆ˜ë¥¼ ì‹¤í–‰í•œë‹¤.  
<br/>
ë˜ê²Œ ê°„ëª…í•˜ë‹¤. í•˜ì§€ë§Œ ì½”ë“œëŠ” ì¢€ë” ë³µì¡í•´ì§€ê¸´ í•´ì„œ, ë”°ë¡œ í•¨ìˆ˜ë¡œ ë¹¼ë‘ëŠ” ê²Œ ë§ëŠ” ê²ƒì²˜ëŸ¼ ë³´ì˜€ë‹¤. ë•Œë§ˆì¹¨ ì½ëŠ” ë§ˆí‹´ íŒŒìš¸ëŸ¬ì—ì„œ ì´ëŸ° ë§ ë‚˜ì˜¤ëŠ”ë°[^2]
> "í›¨ì”¬ ì ê·¹ì ìœ¼ë¡œ í•¨ìˆ˜ë¥¼ ìª¼ê°œì•¼ í•œë‹¤. ìš°ë¦¬ëŠ” ì£¼ì„ì„ ë‹¬ì•„ì•¼ í•  ë§Œí•œ ë¶€ë¶„ì€ ë¬´ì¡°ê±´ í•¨ìˆ˜ë¡œ ë§Œë“ ë‹¤. ê·¸ í•¨ìˆ˜ ë³¸ë¬¸ì—ëŠ” ì›ë˜ ì£¼ì„ìœ¼ë¡œ ì„¤ëª…í•˜ë ¤ë˜ ì½”ë“œê°€ ë‹´ê¸°ê³ , í•¨ìˆ˜ ì´ë¦„ì€ ë™ì‘ ë°©ì‹ì´ ì•„ë‹Œ ì˜ë„ê°€ ë“œëŸ¬ë‚˜ê²Œ ì§“ëŠ”ë‹¤. (......)  
> í•¨ìˆ˜ë¥¼ ì§§ê²Œ ë§Œë“œëŠ” ì‘ì—…ì˜ 99%ëŠ” í•¨ìˆ˜ ì¶”ì¶œí•˜ê¸°ê°€ ì°¨ì§€í•œë‹¤. í•¨ìˆ˜ ë³¸ë¬¸ì—ì„œ ë”°ë¡œ ë¬¶ì–´ ë¹¼ë‚´ë©´ ì¢‹ì„ ì½”ë“œ ë©ì–´ë¦¬ë¥¼ ì°¾ì•„ ìƒˆë¡œìš´ í•¨ìˆ˜ë¡œ ë§Œë“œëŠ” ê²ƒì´ë‹¤."  
> <cite>ì½”ë“œì—ì„œ ë‚˜ëŠ” ì•…ì·¨, p.116</cite>  

ì§€ê¸ˆ ìƒí™©ì— ì ì ˆí•œ ë§ì²˜ëŸ¼ ë“¤ë ¸ë‹¤. ê·¸ë˜ì„œ ìš°ì„  í•¨ìˆ˜ì— ì¹¼ì„ ëŒ”ê³   
<br/>
ë°ì´í„°ë¥¼ êµ¬í•˜ë©´ì„œ ì •ë ¬í•˜ë˜ `getSortedPostsData()`ì˜ ê¸°ëŠ¥ì„ ì•„ë˜ì²˜ëŸ¼ ë¶„ë‹´í–ˆë‹¤.
<CH.Scrollycoding>
*getAllFiles(  )*  
ë°˜ë³µë¬¸ì„ í†µí•´ ëª¨ë“  íŒŒì¼ë“¤ì˜ ì •ë³´ë¥¼ ë¦¬í„´í•œë‹¤
```ts posts.ts
const postsDirectory = path.join(process.cwd(), "drafts");

const getAllFiles = (dir: string) => {
  const folderNames = fs.readdirSync(dir);
  const getAllFilesData = [

    //ë°˜ë³µë¬¸ì´ ë“¤ì–´ì˜¬ ì¥ì†Œ

  ] 

  return getAllFilesData;
};
```
---
*getSortedPostsData()*  
ëª¨ë“  íŒŒì¼ë“¤ì˜ ë°ì´í„°ë¥¼ ë°›ì•„ ìµœì‹ ìˆœìœ¼ë¡œ ì •ë ¬í•œë‹¤.  
(íƒœê·¸ í˜ì´ì§€ëŠ” í•„í„°ë¡œ ë°›ìŒ)
```ts posts.ts mark=2[3:51]
export function getSortedPostsData(tags?: string) {
  const allPostsData = getAllFiles(postsDirectory);

  if (tags) {
    const postsByTag = allPostsData.filter(post => post.tags === tags);
    return postsByTag.sort(({ date: a }, { date: b }) => {
      if (a < b) return 1;
      else if (a > b) return -1;
      else return 0;
    });
  }

  return allPostsData.sort(({ date: a }, { date: b }) => {
    if (a < b) return 1;
    else if (a > b) return -1;
    else return 0;
  });
}
```
</CH.Scrollycoding>
ì´ì œ ë°˜ë³µë¬¸ì„ ì±„ì›Œë³´ì

<br/>
### Reduceë¡œ ë°°ì—´ ë°ì´í„° êµ¬ì„±í•˜ê¸°
<CH.Scrollycoding rows={31}>
*getAllFiles()*  
fs.readdirSync(dir)ëŠ” ë””ë ‰í† ë¦¬ ì•ˆì˜ íŒŒì¼ëª…ì„ ì½ëŠ”ë‹¤.
```ts posts.ts
// ë©”ì¸í´ë” ìœ„ì¹˜
const postsDirectory = path.join(process.cwd(), "drafts");

const getAllFiles = (dir: string) => {
  // í´ë”ì˜ íŒŒì¼ ì´ë¦„ë“¤ì„ ë°°ì—´ë¡œ ì €ì¥
  const folderNames = fs.readdirSync(dir);
  const getAllFilesData = [

    //ë°˜ë³µë¬¸ì´ ë“¤ì–´ì˜¬ ì¥ì†Œ

  ] 

  return getAllFilesData;
};
```
---
*reduce ë°˜ë³µë¬¸*  
íŒŒì¼ëª…ì„ ì–´ë ˆì´ë¡œ ëª¨ì•˜ìœ¼ë‹ˆ ë°˜ë³µë¬¸ì„ ëŒë¦°ë‹¤.
```ts posts.ts focus=3:6
const getAllFiles = (dir: string) => {
  const folderNames = fs.readdirSync(dir);
  // reduce ë©”ì†Œë“œë¥¼ ì´ìš©í•œ ì–´ë ˆì´ ë°˜ë³µ & ë§µí•‘
  const getAllFilesData = folderNames.reduce(()=> {
  
  })

  return getAllFilesData;
};
```
---
*reduce ê°„ë‹¨ ì„¤ëª…*  
ì²«ë²ˆì§¸ ì½œë°±ì—ì„œ ê³„ì‚°ëœ ë¦¬í„´ê°’ì´ ë‘ë²ˆì§¸, ë‘ë²ˆì§¸ì˜ ë¦¬í„´ê°’ì´ ì„¸ë²ˆì§¸... ë§ˆì§€ë§‰ê¹Œì§€ ë„˜ì–´ê°„ë‹¤.
```ts posts.ts focus=3:7
const getAllFiles = (dir: string) => {
  const folderNames = fs.readdirSync(dir);
  // ë‘ë²ˆì§¸ ì¸ìì—ëŠ” ì–´ë ˆì´(folderNames)ì˜ ê°ê°ì˜ ìš”ì†Œ(íŒŒì¼ëª…)ë“¤ì´,
  // ì²«ë²ˆì§¸ ì¸ìì—ëŠ” ì•ì„  ë°˜ë³µì˜ ë¦¬í„´ê°’ì´ ë“¤ì–´ì˜¨ë‹¤ 
  const getAllFilesData = folderNames.reduce((allFiles, file: string) => {
  
  }, [] /* ì´ˆê¸°ê°’ */)

  return getAllFilesData;
};
```
---
*í´ë” ìœ ë¬´ íŒë³„í•˜ê¸°*  
fsì˜ `isDirectory()` ë©”ì†Œë“œëŠ” í´ë”ì¸ì§€ ì•„ë‹Œì§€ boolean ê°’ì„ ë‚´ë±‰ëŠ”ë‹¤.
```ts posts.ts focus=3:8
const getAllFiles = (dir: string) => {
  const folderNames = fs.readdirSync(dir);
  const getAllFilesData = folderNames.reduce((allFiles, file: string) => {
    // ë¨¼ì € fullpathë¥¼ êµ¬í•´ì„œ
    const fullpath = path.join(dir, file);
    // íŒŒì¼ì˜ í´ë” ìœ ë¬´ë¥¼ ê°€ë ¤ë‚¸ë‹¤ (:boolean)
    const isDirectory = fs.statSync(fullpath).isDirectory();
  }, [])

  return getAllFilesData;
};
```
---
*ì „ì²´ì ì¸ ë¡œì§*  
í´ë”ë¥¼ ë§Œë‚˜ë©´ ì¬ê·€í•¨ìˆ˜ê°€ ë˜ê²Œë”, íŒŒì¼ì„ ë§Œë‚˜ë©´ ì˜¤ë¸Œì íŠ¸ í˜•íƒœì˜ ë°ì´í„°ë¥¼ ë¦¬í„´í•˜ê²Œ ë§Œë“ ë‹¤.  
ëˆ„ì ê°’ì€ ë°°ì—´ì•ˆì— ìŠ¤í”„ë ˆë“œë¡œ í’€ì–´ ê³„ì†í•´ì„œ ì´ì–´ì§€ê²Œë” í•œë‹¤.
```ts posts.ts focus=6:30
const getAllFiles = (dir: string) => {
  const folderNames = fs.readdirSync(dir);
  const getAllFilesData = folderNames.reduce((allFiles, file: string) => {
    const fullpath = path.join(dir, file);
    const isDirectory = fs.statSync(fullpath).isDirectory();
    // ë§Œì•½ íŒŒì¼ì´ í´ë”ë¼ë©´ ì´ì „ ë°˜ë³µê¹Œì§€ì˜ ë¦¬í„´ê°’ì€ ìŠ¤í”„ë ˆë“œë¡œ í’€ì–´ì„œ ë†“ê³ 
    // ê·¸ ë’·ìë¦¬ì—ì„  í´ë”ì˜ fullpathë¥¼ ì¸ìë¡œ í•œë²ˆ ë” í•¨ìˆ˜ë¥¼ êµ´ë¦°ë‹¤
    if (isDirectory) return [...allFiles, ...getAllFiles(fullPaths)];
    // í´ë”ê°€ ì•„ë‹ˆë¼ë©´
    else {
      // íŒŒì¼ëª…ì—ì„œ í™•ì¥ìëª…ì„ ì œê±°í•´ idê°’ì„ ì±™ê¸°ê³ 
      const id = file.replace(/\.mdx$/, "");
      // íŒŒì¼ì˜ ì†ë‚´ë¥¼ ì½ëŠ”ë‹¤
      const fileContents = fs.readFileSync(fullpath, "utf-8");
      // ê·¸ì¤‘ì—ì„œë„ gray-matterì˜ ë°ì´í„°ë§Œ ë”°ë¡œ ì±™ê¸´ë‹¤
      const matterResult = matter(fileContents).data;
      return [
        // ë¦¬í„´ë  ê°’ì€ ê²°êµ­ ì–´ë ˆì´ í˜•íƒœì˜ ëˆ„ì ê°’
        ...allFiles,
        // ê°œê°œì˜ ìš”ì†Œë“¤ì€ ì•„ë˜ í˜•íƒœì˜ ì˜¤ë¸Œì íŠ¸ë¥¼ ëˆë‹¤
        {
          id,
          tags: matterResult.tags as string,
          date: matterResult.date as string,
          fullpath,
          ...matterResult,
        },
      ];
    }
  }, []);
  return getAllFilesData;
};
```
---
*íƒ€ì… ì§€ì •*  
êµ¬ì„±í•œ ì˜¤ë¸Œì íŠ¸ë¥¼ ë°”íƒ•ìœ¼ë¡œ íƒ€ì…ì„ ê±¸ì–´ì¤€ë‹¤.
```ts posts.ts focus=1:7
interface FileType {
  id: string;
  date: string;
  tags: string;
  fullpath: string;
  [key: string]: string;
}
// focus[36:45]
const getAllFiles = (dir: string): FileType[] => {
  const folderNames = fs.readdirSync(dir);
  // focus[56:65]
  const getAllFilesData = folderNames.reduce((allFiles:FileType[], file: string) => {
    const fullpath = path.join(dir, file);
    const isDirectory = fs.statSync(fullpath).isDirectory();
    if (isDirectory) return [...allFiles, ...getAllFiles(fullPaths)];
    else {
      const id = file.replace(/\.mdx$/, "");
      const fileContents = fs.readFileSync(fullpath, "utf-8");
      const matterResult = matter(fileContents).data;
      return [
        ...allFiles,
        {
          id,
          tags: matterResult.tags as string,
          date: matterResult.date as string,
          fullpath,
          ...matterResult,
        },
      ];
    }
  }, []);
  return getAllFilesData;
};
```
</CH.Scrollycoding>

<small>(ëª¨ë“  ì£¼ì„ì€ ë¸”ë¡œê·¸ìš©)</small>
<br/>
ì™„ì„±ëœ í•¨ìˆ˜ë¥¼ `getSortedPostsData()` ì•ˆì—ì„œ ë¶€ë¥´ë©´ ë‚˜ë¦„ì˜ ë¦¬íŒ©í„°ë§ ë!
```ts posts.ts focus=2
export function getSortedPostsData(tags?: string) {
  const allPostsData = getAllFiles(postsDirectory);

  if (tags) {
    const postsByTag = allPostsData.filter(post => post.tags === tags);
    return postsByTag.sort(({ date: a }, { date: b }) => {
      if (a < b) return 1;
      else if (a > b) return -1;
      else return 0;
    });
  }

  return allPostsData.sort(({ date: a }, { date: b }) => {
    if (a < b) return 1;
    else if (a > b) return -1;
    else return 0;
  });  
}
```
<br/>
### After
ë‚˜ì²˜ëŸ¼ ê¹”ë”í•´ì¡Œë‹¤
<Img src={'/images/2022/autumm/after.png'} />

<br/>
<hr/>
#### ì°¸ê³ í•œ ìë£Œ  
[^1]: <Lnk text={'ì •ì¸í˜œ ë¸Œì´ë¡œê·¸'} href={'https://velog.io/@inhyejeong59/node%EC%97%90%EC%84%9C-path%EB%A5%BC-%EC%A3%BC%EB%A9%B4-%ED%95%98%EC%9C%84-%EB%AA%A8%EB%93%A0-directory%EC%9D%98-file-%EC%B0%BE%EA%B8%B0'} />
[^2]: ë§ˆí‹´ íŒŒìš¸ëŸ¬, ë¦¬íŒ©í„°ë§ 2íŒ.
